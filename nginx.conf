events {}

http {
    server {
        listen 80;

        root /usr/share/nginx/html;
        charset utf-8;

        # 🔍 Autoindex pour naviguer dans le dépôt
        location / {
            autoindex on;
            autoindex_format html;
            autoindex_localtime on;
            index off;  # Ne pas chercher index.html
        }

        # 📦 Servir les fichiers `Packages.gz` et `Packages` pour APT
        location /dists/ {
            autoindex on;
        }

        location /pool/ {
            autoindex on;
        }

        # 🔥 Assurer la compatibilité entre `Packages.gz` et `Packages`
        location /packages/Packages {
            alias /usr/share/nginx/html/packages/Packages.gz;
            gzip off;
            types { application/x-gzip gz; }
        }

        location /packages/Packages.gz {
            root /usr/share/nginx/html;
            types { application/x-gzip gz; }
            gzip off;
        }

        # 📜 Servir les fichiers `.deb` avec le bon type MIME
        location ~* \.deb$ {
            types { application/vnd.debian.binary-package deb; }
            autoindex on;
        }

        # 🚀 Désactiver la mise en cache des fichiers (`Packages.gz`, `.deb`, etc.)
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
        add_header Pragma "no-cache";
        add_header Expires 0;
    }
}