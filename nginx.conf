events {}

http {
    server {
        listen 80;

        # Set the document root to the package directory
        root /usr/share/nginx/html;
        charset utf-8;

        # Enable automatic directory listing
        location / {
            autoindex on;
            autoindex_format html;
            autoindex_localtime on;
            index off;  # Prevent Nginx from looking for index.html
        }

        # Serve Packages.gz directly (for wget and manual access)
        location /packages/Packages.gz {
            root /usr/share/nginx/html;
            types { application/x-gzip gz; }
            gzip off;
        }

        # Serve Packages.gz as Packages (APT compatibility fix)
        location /packages/Packages {
            alias /usr/share/nginx/html/packages/Packages.gz;
            types { application/x-gzip gz; }
            gzip off;
        }

        # Ensure .deb files are served correctly
        location ~* \.deb$ {
            types {
                application/vnd.debian.binary-package deb;
            }
            autoindex on;
        }

        # Disable caching for real-time updates
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
        add_header Pragma "no-cache";
        add_header Expires 0;
    }
}